\section{Methodisches Vorgehen zur Problemlösung}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Aktueller Stand der Technologie}

\subsubsection{Bluetooth-Technologie}\label{sssec:BLE}
Bluetooth ist eine drahtlose Datenübertragunsgtechnologie, die basierend auf der Funktechnik Verbindungen zwischen Geräten über eine kurze Distanz ermöglicht. Im engen Nahbereich gilt Bluetooth als der Kommunikationsstandard \citep[Vgl.][S. 133]{mobil-sicher}. Mit dem Bluetooth Low Energy (BLE \nomenclature{BLE}{\textbf{B}luetooth \textbf{L}ow \textbf{E}nergy}) Standard, der 2009 verabscheidet wurde der Stromverbrauch für eine Bluetooth-Verbindung in den Endgeräten drastisch reduziert. Dies gelang unter anderem durch kürzere Verbindungsaufbauzeiten und Schlafphasen (Standby) zwischen den Sendezyklen. Eine vergleichende Untersuchung zum Energieverbrauch von Bluetooth und BLE veröffentlichten \cite{ble-energy}. Durch die eingschränkte Sendereichweite von Bluetooth soll die Ortung im DeSearch-Projekt gelingen. Die dementen Patienten tragen kleine BLE-Sendemarken am Körper, die von den fest installierten DeSearch-Boxen erkannt werden, sobald sich der Patient in der Nähe aufhält. So kann auf den ungefähren Aufenthaltsort der Person geschlossen werden, sobald eine der Boxen einen Treffer an die Zentrale meldet. 
\subsubsection{Raspberry Pi}
Für die Zentrale und die DeSearch-Boxen ist zunächst eine Hardware-Entscheidung notwendig. Benötigt werden Mikrocontroller oder Mikrocomputer mit folgenden Eigenschaften:
\begin{itemize}
	\item W-LAN Verbindung von der Box zur Zentrale möglich
	\item Bluetooth-fähige Box zur Markenerkennung
	\item Zentrale muss als Server fungieren und HTTP-Requests senden und verarbeiten können
	\item Datenbank-Installation zur Datenhaltung notwendig
\end{itemize}
Zudem sollen die Kosten pro Gerät so gering wie möglich gehalten werden. \\
Der Rasberry Pi ist ein Mikrocomputer mit einer Grundfläche, die etwas größer ist als eine Kreditkarte. Die Anschaffungskosten liegen ohne Zubehör bei etwa 42 €. Für diese geringen Anschaffungskosten erhält man einen vollwertigen, Linux-Basierten Computer mit einer ARM-CPU, W-LAN und Bluetooth-Schnittstelle. Im Gegensatz zu Mikrocontrollern ist der Raspberry Pi leistungsfähiger und läuft stabiler \citep[Vgl.][S.35ff.]{raspi}. Auf einem Arduino beispielweise kann nur C++-Code in einer Endlos-Schleife ausgeführt werden. Der Pi hingegen bietet die Möglichkeit, Bash-Skripte, Python-Code, Datenbank-Anfragen und Webserver gleichzeitig auszuführen. Die Entscheidung für Raspberry Pi ist auch aufgrund der relativ niedrigen Anschaffungskosten für einen kompletten Rechner mit Betriebssystem gefallen. Für die Entwickler ist das Betriebssystem Linux zudem am einfachsten zu bedienen. Für das Projekt werden Pakete mit SD-Karte, W-LAN und Bluetooth-Dongles, Netzteil und Gehäuse für ca. 75 € pro Paket angeschafft.
\subsubsection{Authentifizierungstechnologie}
\subsubsection{Software-Rollout mit apt und dpgk}
Zum Installieren von Software wird unter Debain basierten System (dazu gehört neben Ubuntu und natürlich Debian selbst auch das Standardbetriebssystem des Raspberry Pi: Rasbian) das Programm "dpkg" verwendet.
Dazu muss eine ".deb" Datei vorliegen. Statt dem manuellen Download, der auch bei jedem Update erneut durchgeführt werden müsste, lässt sich zum Verteilen der deb Dateien apt verwenden.
Apt selbst nimmt keine Installation vor, es kümmert sich lediglich um die Beschaffung der aktuellsten deb Dateien und deren Abhängigkeiten (ebenfalls im deb Format) und reicht diese zur Installation an dpkg weiter.
Neue Programme lassen sich mit "apt-get install <packetname>" installieren.
Dazu hält sich apt eine Liste mit allen verfügbaren Programmen in einem lokalen Cache vor. Um diese Liste zu aktualisieren kann der Befehl "apt-get update" verwendet werden.
Dabei werden alle in der Datei "/etc/sources.list" bzw. dem Ordner "/etc/sources.list.d/" spezifizierten Quellen abgefragt.
Die Quellen werden dabei als URL spezifiziert und können unterschiedlichste Protokolle erfordern.
Beispielsweise HTTP, HTTPS, FTP oder lokale Datenträger.
Zum aktualisieren aller installierten Programme (nach dem ausführen von "apt-get update") wird der Befehl "apt-get upgrade" verwendet. Dabei wird die Softwareliste im Cache mit den installierten Programmen abgeglichen, ist eine aktuellere Version verfügbar wird deren deb Paket heruntergeladen und mittels dpkg installiert.
\newline\textbf{apt}\newline
Zum Aktualisieren der Softwareliste lädt apt zunächst die Release Datei von der Quelle runter, diese ist mit gnupg signiert und enthält Informationen über die Packetquelle wie die unterstützen CPU Architekturen.
Außerdem sind Hash-Summen der Packages Dateien enthalten, da diese nicht gnupg signiert sind.
Danach wir die Package Datei heruntergeladen. Diese Datei ist spezifisch für eine Architektur und kann in einem Repository mehrfach vorkommen.
Sie enthält die Namen aller verfügbaren Pakete dieses Repositories sowie deren Abhängigkeiten, Beschreibung, Pfad und Hash-Werte der zugehörigen deb Datei sowie weitere Metadaten.
\newline\textbf{dpkg}\newline
dpkg installiert, konfiguriert und deinstalliert deb Pakete.
Eine deb Datei enthält in einem Archiv alle Dateien die das zu installierende Programm zur Ausführung benötigt.
Außerdem sind in einem weiteren Archiv verschiedene Kontrolldateien enthalten, eine davon enthält Metadaten wie Namen des Pakets, Abhängigkeiten und der Beschreibung.
Daneben sind (optional) Skripte enthalten die ausgeführt werden bevor oder nachdem das Paket Installiert, Deinstalliert oder Aktualisiert wurde. 

\subsubsection{PostgreSQL}
PostgreSQL ist ein objektrelationales Datenbank-Management-System (DBMS), das aus dem Projekt POSTGRES der kalifornischen Universität Berkeley heraus entstanden ist. Der objektrelationale Ansatz bedeutet eine Erweiterung der relationalen DBMS um die Konzepte der Objektorientierung. Somit können in objektrelationalen DBMS beispielsweise komplexe Datenstrukturen mit Attributen definiert werden oder Vererbungen vorgenommen werden \citep[Vgl.][S. 135f.]{datenbanken}. In anderen DBMS muss hierfür \enquote{object relational mapping} (ORM) hinzugezogen werden, um Objektstrukturen auf relationale Tabellen abzubilden \citep[Vgl.][S. 426]{balzert} Viele Konzepte, die in POSTGRES neu waren, wurden später in kommerzielle DBMS übernommen. PostgreSQL ist die Open-Source-Variante von POSTGRES und unterstützt einen großen Teil des SQL-Standards. Zudem bietet es Features wie komplexe Queries, Fremdschlüsselbeziehungen, Trigger, updatefähige Views und transaktionale Integrität. Außerdem kann der Benutzer PostgreSQL beliebig durch neue Datentypen, Funktionen, Operatoren oder Aggregationsfunktionen erweitern. Aufgrund der Open-Source-Lizenz kann PostgreSQL von jedem verwendet, verbessert oder verteilt werden
\nomenclature{DBMS}{\textbf{D}aten\textbf{b}ank \textbf{M}anagement \textbf{S}ystem}
\citep[Vgl.][preface, S. lxvi]{postgres}. Für das DeSearch-Projekt eignet sich PostgreSQL vor allem wegen seiner Open-Source-Lizenz, was die Kosten für das Projekt gering hält. Zudem ist die Möglichkeit, eigene Datentypen definieren zu können, von Vorteil. Da die Datenbank auf dem Zentral-Raspberry verwendet wird, der meist über SSH in der Konsole bedient wird, ist PostgreSQL einfach zu bedienen, da es über einen Konsolenclienten verfügt.

\subsection{Umsetzung der Anforderungen}

\subsubsection{Vernetzung der DeSearch-Boxen und Infrastruktur}
\subsubsection{User-Authentifizierung}
\subsubsection{Erkennen der Marken und Kommunikation zur Zentrale}
\subsubsection{Datenbankschema}
In Abbildung \ref{img:db-schema} ist das Datenbankschema zu sehen, mit dem die Zentrale arbeitet. 
\begin{figure}
	\centering
	\includegraphics[width=1.0\linewidth]{images/db-schema}
	\caption[Datenbankschema der Zentrale]{Datenbankschema der Zentrale, Quelle: eigene Darstellung}
	\label{img:db-schema}
\end{figure}
\\Für den Zugang zur Web-Oberfläche werden \textbf{Benutzer} mit ihren Rollen in der Datenbank angelegt. Das Passwort wird dabei als Hash mit 128 Zeichen in der Datenbank gespeichert. 
\\Jede \textbf{DeSearch-Box} wird in der Datenbank mit ihrer Position und Boxnummer angelegt. Für die Zukunft wurde bereits das Feld \enquote{Boxtyp} erstellt, da im weiteren Verlauf ortsfeste, mobile und Alarm-Boxen unterschieden werden sollen. Bei mobilen Boxen(z.B. im Auto, in Linienbussen) wird anstatt einer festen Positionsbeschreibung die genaue Geo-Location mit Longitude und Latitude ermittelt. Alarm-Boxen können beispielsweise am Hof-Ausgang oder an der Bushaltestelle installiert werden und standardmäßig immer Alarm auslösen, wenn dort eine Marke gefunden wird.
\\Die \textbf{Marken} werden in der Datenbank mit einer eindeutigen Mac-Adresse abgelegt, die beim Abgleich mit den Scan-Ergebnissen verwendet wird. Außerdem wird die ID des zugehörigen Patienten vermerkt und ein Hinweis auf das jeweilige Kleidungsstück, in das die Marke eingenäht ist. Zusätzlich wird ein Ablaufdatum in die Datenbank eingetragen, das den ungefähren Zeitpunkt des nächsten Batteriewechsels festhält. Somit kann eine Warnmeldung angezeigt werden, wenn der Batteriewechsel fällig ist. Ein wichtiges Feld ist der boolean \enquote{wird\_gesucht}. Wird auf der Web-Oberfläche eine Suche gestartet, so werden alle zu dieser Person gehörigen Marken auf wird\_gesucht gesetzt. Nur dann werden Treffer zu dieser Person von den Boxen an die Zentrale gemeldet. Finden die Suchenden beispielsweise nur ein Kleidungsstück der vermissten Person, können einzelne Marken gezielt von der Suche ausgeschlossen werden. 
\\Ein \textbf{Patient} liegt in der Datenbank mit Name, Vorname und weiteren für die Suche wichtigen Informationen vor. Beispielsweise kann unter Merkmale die Beschreibung einer Person vermerkt werden, unter Medikation und Anmerkungen können wichtige Hinweise im Fall eines Fundes oder einer längeren Abwesenheit der Person gespeichert werden. Gerade bei Diabetikern oder Patienten, die regelmäßig Medikamente nehmen müssen, ist diese Information besonders wichtig. Das Flag \enquote{Auf\_Ausgang} kann gesetzt werden, falls ein Angehöriger mit der Person das Pflegeheim verlässt, beispielsweise für einen Spaziergang. Somit wird ein Fehlalarm verhindert.
\\Die Tabelle \textbf{GefundeneMarken} kann eine Suchaktion protokollieren. Jeder Treffer, den eine Box registriert und an die Zentrale sendet, wird hier dokumentiert. Ein Treffer wird mit der zugehörigen BoxID, der MarkenID, dem Zeitpunkt und der Position in die Datenbank gelegt. Somit können auf der Web-Oberfläche alle Treffer in einer Zeitreihe angezeigt werden. Aus Datenschutzgründen wird diese Tabelle nach jeder abgeschlossenen Suchaktion gelöscht.

\subsubsection{Administrative Benutzeroberfläche}
\subsubsection{Installation der DeSearch-Boxen in der Testumgebung}
Die Raspberry Pi's werden in der DHBW Ravensburg am Campus Friedrichshafen zum Testbetrieb installiert. Dabei fungiert ein Pi als Zentrale und die anderen als DeSearch-Boxen, die die Funde an die Zentrale melden. In Tabelle \ref{tab:pis} ist eine Übersicht über alle installierten Raspberry Pi's aufgelistet.
Dazu wurde uns vom Netzwerkadministrator der DHBW die Erlaubnis eingeräumt, die vorhandene Infrastruktur zu verwenden. Daran geknüpft waren allerdings folgende Bedingungen bzw. Einschränkungen:
\begin{itemize}
	\item Zugriffe aus dem Internet sind nicht erlaubt.
	\item Alle Pi's außer der Zentrale (Slaves) verbinden sich über WLAN unter Verwendung unserer Zugangsdaten mit dem Netzwerk.
	\item Die Zentrale bekommt einen LAN Anschluss und eine feste IP Adresse plus DNS Eintrag zugewiesen.
	\item Ein Verbindungsaufbau zu den Slaves ist nicht möglich - jegliche Kommunikation muss von ihnen initiiert werden.
\end{itemize}
Die letzte Bedingung stelle eine Herausforderung dar, da damit auch kein SSH-Zugriff auf die DeSearch-Boxen möglich ist, der benötigt wird um die DeSearch Anwendung zu aktualisieren, starten oder überwachen.
Dieses Problem konnte gelöst werden, da mit der Zentrale ein Gerät im Netzwerk ist, das für alle anderen Pi's und auch die zur Entwicklung und Wartung verwendeten Laptops erreichbar ist, kann darüber ein Tunnel aufgebaut werden.
Zum Aufbauen des Tunnels hat sich die Verwendung der SSH Portforwarding Funktion angeboten, da alle beteiligten Geräte bereits für die Verwendung von SSH eingerichtet waren. Eine schematische Darstellung der Vorgehensweise finden sie in Abbildung \ref{fig:tunnel}.
Zum Verbindungsaufbau wurde ein technischer Benutzer mit dem Namen "tunnel" auf der Zentrale angelegt, der sich über SSH und Zertifikat Authentifizierung einloggen kann.
Jeder Slave hat einen RSA Schlüssel erhalten, den er zum Login verwenden kann, und über einen Eintrag ein der Crontabelle wird sichergestellt, dass der Tunnel immer offen gehalten wird.
Der Ausgangsport des Tunnels ist dabei für jede DeSearch-Box eindeutig. Soll nun eine Verbindung zu einer Box hergestellt werden, so muss erst eine SSH Verbindung zur Zentrale aufgebaut werden und dort eine SSH Verbindung zum Eingang des Tunnels (localhost plus Tunnel Ausgangport) hergestellt werden.
\begin{table}[h]
	\begin{tabular}{ | p{2,5cm} | p{2,5cm} | p{4cm} | p{6cm} |}
		\hline
		\textbf{Pi-Nummer} & \textbf{Funktion} & \textbf{Installationsort} &  \textbf{Erreichbarkeit} \\ \hline
		3 & Zentrale & Büro Herr Judt & statische IP 141.68.30.39 oder \mbox{Judt-Master.it.ba-ravensburg.de} \\ \hline
		5 & DeSearch-Box & Haupteingang oberhalb der Treppe & Tunnel über Zentrale, Port 19005 \\ \hline
		
	\end{tabular}
	\caption{Übersicht der Raspberry Pi's mit Funktion, Installationsort und Erreichbarkeit}
	\label{tab:pis}
\end{table}

\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{./images/tunnel.png}
	\caption[Schematische Darstellung der Verwendung des SSH Tunnels]{\textbf{Schematische Darstellung der Verwendung des SSH Tunnels} - Beispielhaft ist hier eine Verbindung vom Administrator zur DeSearch-Box 6 dargestellt (roter Pfeil).}
	\label{fig:tunnel}
\end{figure} 

